{
	"2. Treebuilder fixup of formatting elt": {
		"wt2wt": "'''foo'''\n\n'''[[File:Foobar.jpg|thumb|caption]]'''\n\n'''bar'''\n\n<small>[[Image:Foobar.jpg|right|300px]]</small>"
	},
	"3. Treebuilder fixup of formatting elt": {
		"wt2wt": "<small>'''foo''''''[[File:Foobar.jpg|thumb|caption]]''''''bar'''</small>"
	},
	"Allow empty links in image captions (T62753)": {
		"wt2wt": "[[File:Foobar.jpg|thumb|Caption [[Link1]]\n<nowiki>[[]]</nowiki>\n[[Link2]]\n]]"
	},
	"Gallery (with showfilename option)": {
		"wt2html": "<ul class=\"gallery mw-gallery-traditional\" typeof=\"mw:Extension/gallery\" about=\"#mwt3\" data-parsoid='{\"dsr\":[0,179,25,10]}' data-mw='{\"name\":\"gallery\",\"attrs\":{\"showfilename\":\"\"},\"body\":{}}'>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:Error mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"},{\"ck\":\"caption\",\"ak\":\"caption\"}]}' data-mw='{\"errors\":[{\"key\":\"apierror-filedoesnotexist\",\"message\":\"This image does not exist.\"}]}'><a href=\"./Special:FilePath/Nonexistent.jpg\" data-parsoid=\"{}\"><span class=\"mw-broken-media\" resource=\"./File:Nonexistent.jpg\" data-width=\"120\" data-height=\"120\" data-parsoid='{\"a\":{\"resource\":\"./File:Nonexistent.jpg\"},\"sa\":{\"resource\":\"File:Nonexistent.jpg\"}}'>File:Nonexistent.jpg</span></a></span></div><div class=\"gallerytext\" data-parsoid='{\"dsr\":[47,54,0,0]}'><a href=\"./File:Nonexistent.jpg\" class=\"galleryfilename galleryfilename-truncate\" title=\"File:Nonexistent.jpg\" data-parsoid=\"{}\">File:Nonexistent.jpg</a>caption</div></li>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:Error mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"}]}' data-mw='{\"errors\":[{\"key\":\"apierror-filedoesnotexist\",\"message\":\"This image does not exist.\"}]}'><a href=\"./Special:FilePath/Nonexistent.jpg\" data-parsoid=\"{}\"><span class=\"mw-broken-media\" resource=\"./File:Nonexistent.jpg\" data-width=\"120\" data-height=\"120\" data-parsoid='{\"a\":{\"resource\":\"./File:Nonexistent.jpg\"},\"sa\":{\"resource\":\"File:Nonexistent.jpg\"}}'>File:Nonexistent.jpg</span></a></span></div><div class=\"gallerytext\" data-parsoid=\"{}\"><a href=\"./File:Nonexistent.jpg\" class=\"galleryfilename galleryfilename-truncate\" title=\"File:Nonexistent.jpg\" data-parsoid=\"{}\">File:Nonexistent.jpg</a></div></li>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"},{\"ck\":\"caption\",\"ak\":\"some &apos;&apos;&apos;caption&apos;&apos;&apos; [[Main Page]]\"}]}'><a href=\"./File:Foobar.jpg\" class=\"mw-file-description\" title=\"some caption Main Page\" data-parsoid=\"{}\"><img alt=\"some caption Main Page\" resource=\"./File:Foobar.jpg\" src=\"http://example.com/images/thumb/3/3a/Foobar.jpg/120px-Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"14\" width=\"120\" srcset=\"http://example.com/images/thumb/3/3a/Foobar.jpg/180px-Foobar.jpg 1.5x, http://example.com/images/thumb/3/3a/Foobar.jpg/240px-Foobar.jpg 2x\" data-parsoid='{\"a\":{\"resource\":\"./File:Foobar.jpg\",\"height\":\"14\",\"width\":\"120\"},\"sa\":{\"resource\":\"File:Foobar.jpg\"}}'/></a></span></div><div class=\"gallerytext\" data-parsoid='{\"dsr\":[92,124,0,0]}'><a href=\"./File:Foobar.jpg\" class=\"galleryfilename galleryfilename-truncate\" title=\"File:Foobar.jpg\" data-parsoid=\"{}\">File:Foobar.jpg</a>some <b data-parsoid='{\"dsr\":[97,110,3,3]}'>caption</b> <a rel=\"mw:WikiLink\" href=\"./Main_Page\" title=\"Main Page\" data-parsoid='{\"stx\":\"simple\",\"a\":{\"href\":\"./Main_Page\"},\"sa\":{\"href\":\"Main Page\"},\"dsr\":[111,124,2,2]}'>Main Page</a></div></li>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"}]}'><a href=\"./File:Foobar.jpg\" class=\"mw-file-description\" data-parsoid=\"{}\"><img resource=\"./File:Foobar.jpg\" src=\"http://example.com/images/thumb/3/3a/Foobar.jpg/120px-Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"14\" width=\"120\" srcset=\"http://example.com/images/thumb/3/3a/Foobar.jpg/180px-Foobar.jpg 1.5x, http://example.com/images/thumb/3/3a/Foobar.jpg/240px-Foobar.jpg 2x\" data-parsoid='{\"a\":{\"resource\":\"./File:Foobar.jpg\",\"height\":\"14\",\"width\":\"120\"},\"sa\":{\"resource\":\"File:Foobar.jpg\"}}'/></a></span></div><div class=\"gallerytext\" data-parsoid=\"{}\"><a href=\"./File:Foobar.jpg\" class=\"galleryfilename galleryfilename-truncate\" title=\"File:Foobar.jpg\" data-parsoid=\"{}\">File:Foobar.jpg</a></div></li>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"}]}'><a href=\"./File:Redirect_to_foobar.jpg\" class=\"mw-file-description\" data-parsoid=\"{}\"><img resource=\"./File:Redirect_to_foobar.jpg\" src=\"http://example.com/images/thumb/3/3a/Foobar.jpg/120px-Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"14\" width=\"120\" srcset=\"http://example.com/images/thumb/3/3a/Foobar.jpg/180px-Foobar.jpg 1.5x, http://example.com/images/thumb/3/3a/Foobar.jpg/240px-Foobar.jpg 2x\" data-parsoid='{\"a\":{\"resource\":\"./File:Redirect_to_foobar.jpg\",\"height\":\"14\",\"width\":\"120\"},\"sa\":{\"resource\":\"File:Redirect_to_foobar.jpg\"}}'/></a></span></div><div class=\"gallerytext\" data-parsoid=\"{}\"><a href=\"./File:Redirect_to_foobar.jpg\" class=\"galleryfilename galleryfilename-truncate\" title=\"File:Redirect_to_foobar.jpg\" data-parsoid=\"{}\">File:Redirect_to_foobar.jpg</a></div></li>\n</ul>",
		"wt2wt": "<gallery showfilename=\"\">\nFile:Nonexistent.jpg|caption\nFile:Nonexistent.jpg\nFile:Foobar.jpg|some '''caption''' [[Main Page]]\nFile:Foobar.jpg\nFile:Redirect_to_foobar.jpg\n</gallery>"
	},
	"Gallery with wikitext inside gallery caption": {
		"wt2html": "<ul class=\"gallery mw-gallery-traditional\" typeof=\"mw:Extension/gallery\" about=\"#mwt4\" data-parsoid='{\"dsr\":[0,180,139,10]}' data-mw='{\"name\":\"gallery\",\"attrs\":{},\"body\":{}}'>\n<li class=\"gallerycaption\" data-parsoid=\"{}\"># This should not be a list item  Text <b data-parsoid='{\"dsr\":[57,67,3,3]}'>bold</b> <a rel=\"mw:WikiLink\" href=\"./Link?action=edit&amp;redlink=1\" title=\"Link\" class=\"new\" typeof=\"mw:LocalizedAttrs\" data-parsoid='{\"stx\":\"simple\",\"a\":{\"href\":\"./Link\"},\"sa\":{\"href\":\"link\"},\"dsr\":[68,76,2,2]}' data-mw-i18n='{\"title\":{\"lang\":\"x-page\",\"key\":\"red-link-title\",\"params\":[\"Link\"]}}'>link</a> <span about=\"#mwt3\" typeof=\"mw:Transclusion\" data-parsoid='{\"pi\":[[]],\"dsr\":[77,86,null,null]}' data-mw='{\"parts\":[{\"template\":{\"target\":{\"wt\":\"ns:-1\",\"function\":\"ns\"},\"params\":{},\"i\":0}}]}'>Special</span>  <figure class=\"mw-default-size\" typeof=\"mw:File/Thumb\" data-parsoid='{\"optList\":[{\"ck\":\"thumbnail\",\"ak\":\"thumb\"},{\"ck\":\"caption\",\"ak\":\"File in gallery caption\"}],\"dsr\":[88,137,2,2]}'><a href=\"./File:Foobar.jpg\" class=\"mw-file-description\" data-parsoid='{\"dsr\":[90,112,null,null]}'><img resource=\"./File:Foobar.jpg\" src=\"http://example.com/images/thumb/3/3a/Foobar.jpg/180px-Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"20\" width=\"180\" srcset=\"http://example.com/images/thumb/3/3a/Foobar.jpg/270px-Foobar.jpg 1.5x, http://example.com/images/thumb/3/3a/Foobar.jpg/360px-Foobar.jpg 2x\" data-parsoid='{\"a\":{\"resource\":\"./File:Foobar.jpg\",\"height\":\"20\",\"width\":\"180\"},\"sa\":{\"resource\":\"File:Foobar.jpg\"}}'/></a><figcaption data-parsoid='{\"dsr\":[112,135,0,0]}'>File in gallery caption</figcaption></figure></li>\n<li class=\"gallerybox\" style=\"width: 155px;\" data-parsoid=\"{}\"><div class=\"thumb\" style=\"width: 150px; height: 150px;\" data-parsoid=\"{}\"><span typeof=\"mw:File\" data-parsoid='{\"optList\":[{\"ck\":\"width\",\"ak\":\"120x120px\"},{\"ck\":\"caption\",\"ak\":\"Image caption\"}]}'><a href=\"./File:Foobar.jpg\" class=\"mw-file-description\" title=\"Image caption\" data-parsoid=\"{}\"><img alt=\"Image caption\" resource=\"./File:Foobar.jpg\" src=\"http://example.com/images/thumb/3/3a/Foobar.jpg/120px-Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"14\" width=\"120\" srcset=\"http://example.com/images/thumb/3/3a/Foobar.jpg/180px-Foobar.jpg 1.5x, http://example.com/images/thumb/3/3a/Foobar.jpg/240px-Foobar.jpg 2x\" data-parsoid='{\"a\":{\"resource\":\"./File:Foobar.jpg\",\"height\":\"14\",\"width\":\"120\"},\"sa\":{\"resource\":\"File:Foobar.jpg\"}}'/></a></span></div><div class=\"gallerytext\" data-parsoid='{\"dsr\":[156,169,0,0]}'>Image caption</div></li>\n</ul>"
	},
	"Image with multiple attributes from the same template": {
		"wt2wt": "[[File:Foobar.jpg|right|Caption text]]"
	},
	"Image: upright option is ignored on inline and frame images (parsoid)": {
		"wt2wt": "[[File:Foobar.jpg|500x500px|caption]]"
	},
	"Simple image redirect": {
		"wt2html": "<p data-parsoid='{\"dsr\":[0,32,0,0]}'><span class=\"mw-default-size\" typeof=\"mw:File\" data-parsoid='{\"optList\":[],\"dsr\":[0,32,null,null]}'><a href=\"./File:Redirect_to_foobar.jpg\" class=\"mw-file-description\" data-parsoid=\"{}\"><img resource=\"./File:Redirect_to_foobar.jpg\" src=\"http://example.com/images/3/3a/Foobar.jpg\" decoding=\"async\" data-file-width=\"1941\" data-file-height=\"220\" data-file-type=\"bitmap\" height=\"220\" width=\"1941\" data-parsoid='{\"a\":{\"resource\":\"./File:Redirect_to_foobar.jpg\",\"height\":\"220\",\"width\":\"1941\"},\"sa\":{\"resource\":\"Image:Redirect to foobar.jpg\"}}'/></a></span></p>"
	},
	"Unlinked media in gallery": {
		"wt2wt": "<gallery>\nFile:Foobar.jpg|stuff\n</gallery>"
	}
}
